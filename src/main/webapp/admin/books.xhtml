<!DOCTYPE html>
<html xmlns="http://www.w3c.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui">
	 <h:head>
	 	<link rel="stylesheet" type="text/css" href="css/books.css" />
	 	<title>E-library: admin</title>
	 	<h:outputStylesheet library="primefaces-omega" name="theme.css" />
	 	<h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>
	 </h:head>
	 <h:body>
	 	<h:form id="sections_form">
		 	<div class="topMenu">
		 		<p:tabMenu activeIndex="2">
		 			<p:menuitem value="Sections" outcome="/admin/sections.xhtml"></p:menuitem>
			        <p:menuitem value="Users" outcome="/admin/users.xhtml"></p:menuitem>
			        <p:menuitem value="Books" outcome="/admin/books.xhtml"></p:menuitem>
			        <p:menuitem value="Home" url="../home"></p:menuitem>
			    </p:tabMenu>
		 	</div>
			<div class="leftMenu">
				<div>
					<p:treeTable id="nodes" value="#{sectionService.root}" var="node"
						selectionMode="single" expanded="true"
						selection="#{sectionService.selectedNode}">
						<p:column headerText="Section">
							<h:outputText value="#{node.name}" />
						</p:column>
						<p:ajax event="select" listener="#{sectionService.onNodeSelect}" 
								update=":sections_form:books"
								onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>
					</p:treeTable>
					<p:contextMenu for="nodes">
						<p:menuitem value="Add section" onclick="PF('inputDlg').show()" />
						<p:menuitem value="Delete section" update="nodes"
							action="#{sectionService.deleteNode}" />
					</p:contextMenu>
				</div>
			</div>
			<div class="booksContent">
				<div><p:commandButton value="Load book" onclick="PF('createBookDlg').show()"/></div>
				<p:dataTable id="books" var="book" value="#{sectionService.books}" 
	 						selection="#{sectionService.selectedBook}" rowKey="#{book.id}" selectionMode="single">
		 			<p:column style="width:50px;" headerText="id">
	                	<h:outputText value="#{book.id}" />
		            </p:column>
		            <p:column headerText="Name">
		                <h:outputText value="#{book.name}" />
		            </p:column>
		        </p:dataTable>
			</div>
		</h:form>
		
		<!-- Book create dialogue -->
			<p:dialog id="createBookDialog" for="booksContent" header="Create book" widgetVar="createBookDlg" 
					responsive="true" showEffect="fade">
		        <h:form>
		        	<table>
		        		<tr>
		        			<td>Name</td>
		        			<td><p:inputText id="bookName" value="#{sectionService.bookService.name}"/></td>
		        		</tr>
		        		<tr>
		        			<td>Description</td>
		        			<td><p:inputText id="bookDescr" value="#{sectionService.bookService.description}"/></td>
		        		</tr>
		        	</table>
		        	<p:fileUpload mode="advanced"
		                      multiple="false"
		                      sizeLimit="136314880" 
		                      invalidSizeMessage="Maximum file size allowed is 130 MB"
		                      invalidFileMessage="only gif | jpg | jpeg | png is allowed"
		                      fileUploadListener="#{sectionService.bookService.uploadBook}"
		                      closable="true"/>
		            <p:commandButton value="OK" actionListener="#{sectionService.bookService.appendBook}"
		            		onclick="PF('createBookDlg').hide()"/>
			    </h:form>
			</p:dialog>

		<!-- Dialogue for form creating -->
	 	<p:dialog id="inputDialog" for="nodes" header="Add section" widgetVar="inputDlg" minHeight="40" width="350" showEffect="fade">
	        	<h:form>
				    <p class="p-m-0">Input section name:</p>
				    <p:inputText value="#{sectionService.sectionName}"/>
				    <p:commandButton value="OK" onclick="dialog.hide();"
				    actionListener="#{sectionService.appendNode}"/>
			    </h:form>
		</p:dialog>
		
		<!-- AJAX waiting clock -->
		<p:dialog widgetVar="statusDialog" modal="false" draggable="false" closable="false" resizable="false" showHeader="false">
	        <div class="p-text-center">
	            <i class="pi pi-clock fa-2x" aria-hidden="true"></i>
	        </div>
	    </p:dialog>
	 </h:body>
</html>
