<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>PDF reader</title>
		<link rel="stylesheet" type="text/css" href="css/reader-pdf.css" />
	</head>
	<body>
		<div id="app">
	      <div role="toolbar" id="toolbar">
	        <div id="pager">
	          <button data-pager="prev">prev</button>
	          <button data-pager="next">next</button>
	        </div>
	        <div id="page-mode">
	          <label>Page Mode <input type="number" value="1" min="1"/></label>
	        </div>
	      </div>
	      <div id="viewport-container"><div role="main" id="viewport"></div></div>
	    </div>
	</body>
	<script src="js/elib.routes.js"></script>
	
	<script type="text/javascript">
		var urlString = window.location.href;
		var url = new URL(urlString);
		var bookId = url.searchParams.get("id");
		
		let currentPage = 0;
		
		// Write opened book to history
		let createStamp = function() {
			let pathToPost = router.getBookHistory();
			var xhr = new XMLHttpRequest();
			xhr.open("POST", pathToPost, true);
			xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.send(JSON.stringify({
				    id: bookId,
				    page: currentPage
			}));
		}
	</script>
	
	<script src="https://unpkg.com/pdfjs-dist@2.0.489/build/pdf.min.js"></script>
    <script src="js/reader-pdf.js"></script>
    
    <script>
    	initPDFViewer(router.getBook(bookId));

    	// Open book at last opened page
    	let pageReq = new XMLHttpRequest();
		pageReq.open("GET", router.getBookLastPage(bookId), true);
		pageReq.setRequestHeader('Content-Type', 'application/json');
		pageReq.onload = function() {
			currentPageIndex = parseInt(pageReq.response);
			console.log(currentPageIndex);
			driver.setPage(parseInt(pageReq.response));
			if(pageReq.response==0)
				createStamp();
		};
		pageReq.send('page-info'); 
    </script>
</html>